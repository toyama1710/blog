<!doctype html><head>
<html lang=ja-jp>
<title>AVL木書いた2 | toyama1710 blog</title>
<meta charset=utf-8>
<meta name=generator content="Hugo 0.91.2">
<meta name=description content="列を超高機能に扱うタイプのAVL木書いた">
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel=stylesheet href=https://blog.toyama1710.net/css/syntax.css>
<link rel=stylesheet href=https://blog.toyama1710.net/css/index.css>
<link rel=stylesheet href=https://blog.toyama1710.net/css/classes.css>
<link rel=canonical href=https://blog.toyama1710.net/posts/2021/09/07/avl2/>
<link rel=alternate type=application/rss+xml href title="toyama1710 blog">
<link rel=icon type=image/png href=/img/site_icon.png>
<link rel=apple-touch-icon type=image/png href=/img/site_icon.png>
<link rel=apple-touch-icon-precomposed type=image/png href=/img/site_icon.png>
<meta property="og:url" content="https://blog.toyama1710.net/posts/2021/09/07/avl2/">
<meta property="og:site_name" content="toyama1710 blog">
<meta property="og:title" content="AVL木書いた2">
<meta property="og:description" content="列を超高機能に扱うタイプのAVL木書いた">
<meta property="og:type" content="article">
<meta property="og:image" content="https://blog.toyama1710.net/img/default_thumbnail.png">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:site content="@toyama_pts">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-7T7034HPMW"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-7T7034HPMW')</script>
</head>
<body>
<header class=dark>
<a href=https://blog.toyama1710.net/ class=head_title>toyama1710 blog</a>
<a href=https://blog.toyama1710.net/posts/ class=head_posts>posts</a>
<a href=https://blog.toyama1710.net/tags/ class=head_tags>tags</a>
<a href=https://blog.toyama1710.net/categories/ class=head_categories>categories</a>
</div>
</header>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css integrity=sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq crossorigin=anonymous>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js integrity=sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js integrity=sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI crossorigin=anonymous onload=renderMathInElement(document.body)></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script>
<article>
<header>
<h1 style=margin-bottom:0 class=title>AVL木書いた2</h1>
<p class=meta><time datetime=2021-09-07T16:21:32+09:00>September 07, 2021</time></p>
<div class="categories meta">
<p>categories:</p>
<ul class=categories_list>
<li class=categories_item><a href=https://blog.toyama1710.net/categories/%e7%ab%b6%e3%83%97%e3%83%ad/ class=categories_item>競プロ</a></li>
</ul>
</div>
<div class="tags meta">
<p>tags:</p>
<ul class=tags_list>
<li class=tags_item><a href=https://blog.toyama1710.net/tags/%e3%83%a9%e3%82%a4%e3%83%96%e3%83%a9%e3%83%aa/>ライブラリ</a></li><li class=tags_item><a href=https://blog.toyama1710.net/tags/%e5%b9%b3%e8%a1%a1%e4%ba%8c%e5%88%86%e6%9c%a8/>平衡二分木</a></li>
</ul>
</div>
</div>
</header>
<aside>
<div class=toc>
<details>
<summary>Table of Contents</summary>
<nav id=TableOfContents>
<ul>
<li><a href=#外から叩くやつ>外から叩くやつ</a>
<ul>
<li><a href=#template引数>template引数</a></li>
<li><a href=#insert_atint-k-const-t-dat>insert_at(int k, const T &dat)</a></li>
<li><a href=#setint-k-const-t-dat>set(int k, const T &dat)</a></li>
<li><a href=#erase_atint-k>erase_at(int k)</a></li>
<li><a href=#foldint-l-int-r>fold(int l, int r)</a></li>
<li><a href=#updateint-l-int-r-const-e-op>update(int l, int r, const E &op)</a></li>
<li><a href=#reverseint-l-int-r>reverse(int l, int r)</a></li>
<li><a href=#rotateint-l-int-mid-int-r>rotate(int l, int mid, int r)</a></li>
<li><a href=#appendavlarray-r>append(AVLArray &r)</a></li>
<li><a href=#split_atint-k>split_at(int k)</a></li>
<li><a href=#operator->operator []</a></li>
</ul>
</li>
<li><a href=#内部実装用のやつ>内部実装用のやつ</a>
<ul>
<li><a href=#push_downnode-u>push_down(Node *u)</a></li>
<li><a href=#balancenode-u>balance(Node *u)</a></li>
<li><a href=#mergenode-mid-node-l-node-r>merge(Node *mid, Node *l, Node *r)</a></li>
</ul>
</li>
</ul>
</nav>
</details>
</div>
</aside><hr>
<p><a href=https://toyama1710.github.io/cpp_library/bbst/avl_array.hpp>AVLArray</a>のドキュメント
AVL木で任意区間の切り貼り、区間反転、区間更新、区間積を $\Theta (\log N)$ でできるやつ書いた</p>
<p><a href=https://judge.yosupo.jp/problem/dynamic_sequence_range_affine_range_sum>DynamicSequanceRangeAffineRangeSum</a>が解ける</p>
<h2 id=外から叩くやつ>外から叩くやつ</h2>
<h3 id=template引数>template引数</h3>
<p>MonoidwithOperator が満たすべき要件は<a href=https://blog.toyama1710.net/posts/2020/12/21/segtree/#monoidwithoperator>LazySegmentTree</a>と同じ</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=k>struct</span> <span class=nc>A</span> <span class=p>{</span>
    <span class=k>using</span> <span class=n>value_structure</span> <span class=o>=</span> <span class=n>M</span><span class=p>;</span>
    <span class=k>using</span> <span class=n>operator_structrue</span> <span class=o>=</span> <span class=n>O</span><span class=p>;</span>
    <span class=k>using</span> <span class=n>T</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>M</span><span class=o>::</span><span class=n>value_type</span><span class=p>;</span>
    <span class=k>using</span> <span class=n>E</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>O</span><span class=o>::</span><span class=n>value_type</span><span class=p>;</span>
    <span class=k>static</span> <span class=n>T</span>  <span class=nf>operation</span><span class=p>(</span><span class=n>T</span> <span class=n>dat</span><span class=p>,</span> <span class=n>E</span> <span class=n>op</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>dat</span> <span class=o>+</span> <span class=n>op</span><span class=p>;</span>
    <span class=p>};</span>
<span class=p>};</span>
</code></pre></div><h3 id=insert_atint-k-const-t-dat>insert_at(int k, const T &dat)</h3>
<p>列の左からk番目にdatを挿入する(0-indexed) $\Theta (\log N)$<br>
arr.insert_at(0, dat); で列のはじめにdatを挿入する arr.insert_at(n, dat); で列の最後に追加</p>
<h3 id=setint-k-const-t-dat>set(int k, const T &dat)</h3>
<p>arr[k] = dat ができる $\Theta (\log N)$</p>
<h3 id=erase_atint-k>erase_at(int k)</h3>
<p>列の左からk番目の要素を削除する　残った要素は順序を保って連結される</p>
<h3 id=foldint-l-int-r>fold(int l, int r)</h3>
<p>[l, r)のモノイドの積を返す $\Theta (\log N)$</p>
<h3 id=updateint-l-int-r-const-e-op>update(int l, int r, const E &op)</h3>
<p>[l, r)に作用素opを適用する $\Theta (\log N)$</p>
<h3 id=reverseint-l-int-r>reverse(int l, int r)</h3>
<p>[l, r)の要素の順序を逆転させる<br>
例えば、{0, 1, 2, 3, 4, 5} で [1, 4) を reverse すると {0, 3, 2, 1, 4, 5} になる $\Theta (\log N)$</p>
<h3 id=rotateint-l-int-mid-int-r>rotate(int l, int mid, int r)</h3>
<p><a href=https://cpprefjp.github.io/reference/algorithm/rotate.html>std::rotate</a>と同じことが $\Theta(\log N)$ でできる<br>
midが先頭に来るように[l, r)を巡回左シフトする</p>
<h3 id=appendavlarray-r>append(AVLArray &r)</h3>
<p>rをそっくりそのまま配列の直後に追加する<br>
append()を呼び出したあと、rは空になる $\Theta (\log N)$</p>
<h3 id=split_atint-k>split_at(int k)</h3>
<p>[0, k), [k, n) で配列を分割してpairで返す　元の配列は空になる $\Theta (\log N)$</p>
<h3 id=operator->operator []</h3>
<p>はい $\Theta (\log N)$</p>
<h2 id=内部実装用のやつ>内部実装用のやつ</h2>
<h3 id=push_downnode-u>push_down(Node *u)</h3>
<p>uで遅延させている値やrev_flagを伝播させる</p>
<h3 id=balancenode-u>balance(Node *u)</h3>
<p>uを根とする部分木を平衡させる<br>
rotateを呼び出す前にpush_down()を必ず呼び出す　rev_flagを処理したときに平衡係数の正負が反転して正しく木を回転させられなくなるため</p>
<h3 id=mergenode-mid-node-l-node-r>merge(Node *mid, Node *l, Node *r)</h3>
<p>l, mid, r の順で木をmergeする<br>
midは単一のノード, lとrは木の根<br>
基本的な戦略はl, r の高さの差が十分小さくなるまで木を潜っていって、midの左子をl,右子をrとする
l が高い場合はl->ch[1] = merge(mid, l->ch[1], r);としてやればおーけー</p>
<hr>
<nav class=prev_next>
<a href=https://blog.toyama1710.net/posts/2021/09/08/doubling_tree/ class=larrow>
ダブリングでLCA求めるやつ(DoublingTree)
</a>
<a href=https://blog.toyama1710.net/posts/2021/09/02/avl/ class=rarrow>
AVL木書いた
</a>
</nav>
</nav>
</article>
<footer>
<ul>
<li><address><a href=https://github.com/toyama1710/ target=_blank rel="noopener noreferrer">github</a></address></li>
<li><address><a href=https://twitter.com/toyama_pts/ target=_blank rel="noopener noreferrer">twitter</a></address></li>
</ul>
<ul>
<li>
<p>Built with <a href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a>
using <a href=https://themes.gohugo.io/contrast-hugo/ target=_blank rel="noopener noreferrer">contrast-hugo</a> theme.</p>
</li>
</ul>
<ul>
<li><p>This site use Google Analytics.</p></li>
<li><p><a href=/privacy/>Privacy Policy</a></p></li>
</ul>
<ul>
<li>
<p>&copy; 2020 toyama1710</p>
</li>
</ul>
</footar>
</body>
</html>